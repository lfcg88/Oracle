DELETE PLAN_TABLE WHERE STATEMENT_ID='&1'
/
EXPLAIN PLAN SET STATEMENT_ID='&1' FOR
SELECT A.ARQ_SENTIDO DIRECAO,   A.ARQ_DATA_HORA DATA_HORA,   A.ARQ_NUM_TRANS_PTU NUM_TRANS_PTU,   
                   A.ARQ_CAB_UNI_PRESTADORA UNI_PRESTADORA, A.ARQ_CAB_UNI_ORIGEM_BENEF UNI_ORIGEM_BENEF,   
                   T.TRU_NUM_AUTORIZACAO_GESTAO NUM_AUTORIZACAO_GESTAO,   T.TRU_NUM_TRANS_PRESTADORA NUM_TRANSACAO_PRESTADORA,   
                   T.TRU_NUM_TRANS_ORIGEM_BENEF NUM_TRANSACAO_ORIGEM_BENEF,   
                   DECODE(T.TRU_STATUS, '0', 'Em análise', '1', 'Negada', '2', 'Autorizada', '3', 'Parc. autorizada', '4', 'Pendente Auditoria', '5', 'Cancelada', '6', 'Inconsistente') STATUS,   
                   T.TRU_COD_UNIMED_BENEFICIARIO UNI_BENEF, T.TRU_COD_BENEFICIARIO COD_BENEF,   
                   SUBSTR(F_Obtem_Nome_Benef(T.TRU_COD_UNIMED_BENEFICIARIO, T.TRU_COD_BENEFICIARIO),1,80) NOME_BENEF,  
                   T.TRU_COD_PRESTADOR_REQUISITANTE ||' '|| DECODE(P_REQ.PSS_TIPO_PESSOA, 'F', PF_REQ.PSF_NOME, 'J', PJ_REQ.PSJ_RAZAO_SOCIAL) PRESTADOR_REQUISITANTE,  
                   T.TRU_COD_PRESTADOR_EXECUTANTE ||' '|| DECODE(P_EXE.PSS_TIPO_PESSOA, 'F', PF_EXE.PSF_NOME, 'J', PJ_EXE.PSJ_RAZAO_SOCIAL) PRESTADOR_EXECUTANTE,  
                   T.TRU_OBSERVACAO OBSERVACAO,  A.ARQ_CAB_TIPO_TRANSACAO TIPO_TRANSACAO,  
                   DECODE(A.ARQ_CAB_TIPO_TRANSACAO, '00500',  'Solicitação', '00506', 'Ordem de serviço') DESC_TIPO_TRANSACAO,  
                   F_OBTEM_SUB_TRANSACOES_PTU(T.TRU_NUM_AUTORIZACAO_GESTAO_REF) SUB_TRANSACOES,  
                   T.TRU_CODIGO_OPERADOR OPERADOR,  
                   DECODE(T.TRU_DATA_RESPOSTA_WSD, null,DECODE(T.TRU_TIPO_AUTORIZACAO, 1, 'Unimed', 2, 'WSD', 'Unimed'),'A1100') TIPO_AUTORIZACAO,  
                   DECODE(F_Possui_Diaria_PTU(A.ARQ_NUM_TRANS_PTU),1,'S','N') POSSUI_INTERNACAO  
  FROM PTU_TRANSACOES T,   PTU_ARQUIVOS A,   INF_CONTRATOS_DE_PRESTADOR CP_REQ, INF_PESSOAS P_REQ, 
                   INF_PESSOAS_FISICAS PF_REQ, INF_PESSOAS_JURIDICAS PJ_REQ, INF_CONTRATOS_DE_PRESTADOR CP_EXE, INF_PESSOAS P_EXE, INF_PESSOAS_FISICAS PF_EXE, INF_PESSOAS_JURIDICAS PJ_EXE 
 WHERE A.ARQ_CAB_TIPO_TRANSACAO = '00500'  
   AND TRUNC(A.ARQ_DATA_HORA) BETWEEN to_date('09/02/2012','dd/mm/yyyy') 
   AND to_date('12/03/2012','dd/mm/yyyy')  
   AND T.TRU_ARQ_NUM_TRANS_PTU = A.ARQ_NUM_TRANS_PTU   
   AND T.TRU_COD_PRESTADOR_REQUISITANTE = CP_REQ.CTP_COD_CONTRATO(+)   
   AND CP_REQ.CTP_PSS_COD_PESSOA = P_REQ.PSS_COD_PESSOA(+)   
   AND P_REQ.PSS_COD_PESSOA = PF_REQ.PSF_PSS_COD_PESSOA(+)   
   AND P_REQ.PSS_COD_PESSOA = PJ_REQ.PSJ_PSS_COD_PESSOA(+)   
   AND T.TRU_COD_PRESTADOR_EXECUTANTE = CP_EXE.CTP_COD_CONTRATO(+)   
   AND CP_EXE.CTP_PSS_COD_PESSOA = P_EXE.PSS_COD_PESSOA(+)   
   AND P_EXE.PSS_COD_PESSOA = PF_EXE.PSF_PSS_COD_PESSOA(+)   
   AND P_EXE.PSS_COD_PESSOA = PJ_EXE.PSJ_PSS_COD_PESSOA(+) 
 ORDER BY A.ARQ_DATA_HORA DESC
/
SET PAGESIZE 100
SET LINESIZE 200
SET VERIFY OFF

COLUMN plan             FORMAT A80
COLUMN object_name      FORMAT A30
COLUMN object_type      FORMAT A15
COLUMN bytes            FORMAT 9999999999
COLUMN cost             FORMAT 9999999
COLUMN partition_start  FORMAT A20
COLUMN partition_stop   FORMAT A20

SELECT LPAD(' ', 2 * (level - 1)) ||
       DECODE (level,1,NULL,level-1 || '.' || pt.position || ' ') ||
       INITCAP(pt.operation) ||
       DECODE(pt.options,NULL,'',' (' || INITCAP(pt.options) || ')') plan,
       pt.object_name,
       pt.object_type,
       pt.bytes,
       pt.cost,
       pt.partition_start,
       pt.partition_stop
FROM   plan_table pt
START WITH pt.id = 0
  AND pt.statement_id = '&1'
CONNECT BY PRIOR pt.id = pt.parent_id
  AND pt.statement_id = '&1'
/
